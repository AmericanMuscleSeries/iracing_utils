syntax = "proto3";
package american_muscle_series;
option optimize_for = SPEED;

// Data structures describing the league

enum eGroup
{
  Unknown=0;
  Pro=1;
  Am=2;
}

message GroupRuleData
{
  int32     MinCarNumber   = 1;
  int32     MaxCarNumber   = 2;
  eGroup    Group          = 3;
}

message GroupRulesData
{
  repeated GroupRuleData GroupRule = 1;
}

message SeasonRaceData
{
  int32 Season = 1;
  int32 Race   = 2;
}

message TimePenaltyData
{
  SeasonRaceData SeasonRace = 1;
  int32          Driver     = 2;
  int32          Seconds    = 3;
}

message ScoringSystemData
{
  int32  PolePosition = 1;
  int32  FastestLap   = 2;
  int32  LapsLead     = 3;
}

// Race winner will get TopScore, each subsequent racer will get 1 less point
// Drivers outside of the TopScore will get zero points (not negative points)
message LinearDecentScoringData
{
  ScoringSystemData Base     = 1;
  int32             TopScore = 2;
}

// Race winner will get TopScore, each subsequent racer will get 1 less point
// Drivers outside of the TopScore will get zero points (not negative points)
message AssignmentScoringData
{
  ScoringSystemData Base          = 1;
  map<int32,int32>  PositionScore = 2; // Key is position, value is the the amount of points awarded
}

message AnyScoringSystemData
{
  oneof System
  {
    LinearDecentScoringData  LinearDecent = 1;
    AssignmentScoringData    Assignment   = 2;
  }
}

message GoogleTabData // Can't make a map with an enum as key :-(
{
  eGroup Group   = 1;
  string TabName = 2;
}
message GoogleSheetsData
{
  string                 Key      = 1;
  repeated GoogleTabData GroupTab = 2;
}

message LeagueConfigurationData
{
  int32                         iRacingID        = 1;
  AnyScoringSystemData          ScoringSystem    = 2;
  int32                         NumDrops         = 3;
  repeated int32                NonDrivers       = 4;
  repeated SeasonRaceData       PracticeRace     = 5;
  map<int32, GroupRulesData>    SeasonGroupRules = 6;
  repeated TimePenaltyData      TimePenalty      = 7;
  map<int32, GoogleSheetsData>  GoogleSheets     = 8; // key is season number
}

// Data structures for holding iRacing data

message LeagueData
{
  map<int32, MemberData> Members = 1; // Key is driver iracing id
  map<int32, SeasonData> Seasons = 2; // Key is season number
}

message MemberData
{
  string    Name     = 1;
  string    Nickname = 2;
}

message SeasonData
{
  map<int32, DriverData> Drivers = 1; // Key is driver iracing id
  map<int32, RaceData>   Races   = 2; // Key is race number
}

message DriverData
{
  int32     CarNumber          = 1;
  eGroup    Group              = 2;
  int32     Points             = 3;
  int32     TotalFastestLaps   = 4;
  int32     TotalIncidents     = 5;
  int32     TotalLapsComplete  = 6;
  int32     TotalLapsLead      = 7;
  int32     TotalPolePositions = 8;
  int32     TotalRaces         = 9;
  float     Mu                 = 10; // Trueskill
  float     Sigma              = 11; // Trueskill
}

message GroupStatsData // Can't make a map with an enum as key :-(
{
  eGroup Group              = 1;
  int32  Count              = 2;
  int32  PolePositionDriver = 3;
  int32  PolePosition       = 4;
  int32  FastestLapDriver   = 5;
  float  FastestLapTime     = 6;
}

message RaceData
{
  string                  Date       = 1;
  string                  Track      = 2;
  map<int32, ResultData>  Grid       = 3; // key is driver iracing id
  repeated GroupStatsData GroupStats = 4;
}

message ResultData
{
  bool   PolePosition   = 1;
  bool   FastestLap     = 2;
  int32  StartPosition  = 3;
  int32  FinishPosition = 4;
  int32  Points         = 5;
  float  Interval       = 6;
  int32  Incidents      = 7;
  int32  LapsCompleted  = 8;
  int32  LapsLead       = 9;
  float  Mu             = 10; // Trueskill
  float  Sigma          = 11; // Trueskill
}

